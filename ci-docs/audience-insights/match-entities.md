---
title: Соответствие сущностей для унификации данных
description: Найдите совпадения сущностей для создания унифицированных профилей клиентов.
ms.date: 10/14/2020
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: m-hartmann
ms.author: mhart
ms.reviewer: adkuppa
manager: shellyha
ms.openlocfilehash: 05afd17b7f1b34f7f24a8fa8cb2dc32c1649d40f
ms.sourcegitcommit: 139548f8a2d0f24d54c4a6c404a743eeeb8ef8e0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2021
ms.locfileid: "5267494"
---
# <a name="match-entities"></a>Поиск совпадений сущностей

После завершения этапа сопоставления вы готовы к поиску соответствий в ваших объектах. На этапе соответствия указывается, как объединить наборы данных в единый набор данных профиля клиента. Фаза соответствия требует по крайней мере [двух сопоставленных сущностей](map-entities.md).

## <a name="specify-the-match-order"></a>Задание порядка установления соответствия

Перейдите **Данные** > **Объединить** > **Соответствие** и выберите **Задать порядок**, чтобы начать фазу соответствия.

Каждое соответствие объединяет две или более сущностей в одну сущность, сохраняя при этом каждую уникальную запись клиента. В следующем примере мы выбрали три сущности: **ContactCSV: TestData** как **Основная** сущность, **WebAccountCSV: TestData** как **Сущность 2** и **CallRecordSmall: TestData** как **Сущность 3**. Диаграмма над сделанным выбором иллюстрирует, как будет выполняться порядок соответствия.

> [!div class="mx-imgBorder"]
> ![Изменение порядка поиска соответствия данных](media/configure-data-match-order-edit-page.png "Изменение порядка поиска соответствия данных")
  
Сущность **Основная** сопоставляется с сущностью **Сущность 2**. Набор данных, получившийся после первого поиска соответствий, сопоставляется с **Сущность 3**.
В этом примере мы выбрали только два соответствия, но система может поддерживать больше.

> [!IMPORTANT]
> Сущность, которую вы выбираете в качестве **Основной** сущности будет служить основой для вашего единого набора данных. К этому объекту будут добавлены дополнительные объекты, выбранные на этапе соответствия. В то же время это не означает, что единая сущность будет включать в себя *все* данные, включенные в эту сущность.
>
> Есть два соображения, которые могут помочь вам выбрать иерархию ваших сущностей:
>
> - Какую сущность вы считаете содержащей наиболее полные и надежные данные о ваших клиентах?
> - Есть ли у только что идентифицированной сущности атрибуты, которыми также используются другими сущностями (например, имя, номер телефона или адрес электронной почты)? Если нет, выберите вторую наиболее надежную сущность.

Выберите **Готово**, чтобы сохранить ваш порядок поиска соответствий.

## <a name="define-rules-for-your-first-match-pair"></a>Определение правил для первой пары соответствий

После задания порядка поиска соответствий вы увидите определенные соответствия на странице **Соответствие**. Плитки в верхней части экрана будут пустыми до тех пор, пока вы не запустите порядок поиска соответствий.

> [!div class="mx-imgBorder"]
> ![Определение правил](media/configure-data-match-need-rules.png "Определение правил")

Предупреждение **Требуются правила** предполагает, что для пары соответствий не определено правило соответствия. Правила соответствия определяют логику, по которой будет производиться поиск соответствий в определенной паре сущностей.

1. Чтобы определить первое правило, откройте панель **Определение правил**, выбрав соответствующую строку соответствия в таблице соответствий (1), затем выберите **Создать новое правило** (2).

   > [!div class="mx-imgBorder"]
   > ![Создать новое правило](media/configure-data-match-new-rule2.png "Создать новое правило")

2. На панели **Изменить правило** настройте условия для этого правила. Каждое условие представлено двумя строками, которые включают обязательный выбор.

   > [!div class="mx-imgBorder"]
   > ![Панель создания правила](media/configure-data-match-new-rule-condition.png "Панель создания правила")

   Сущность/Поле (первый) — атрибут, который будет использоваться для поиска соответствий для первой пары сущностей. Примеры могут включать номер телефона или адрес электронной почты. Выберите атрибут, который может быть уникальным для клиента.

   > [!TIP]
   > Избегайте поиска соответствий на основе атрибутов типа действий. Другими словами, если атрибут кажется действием, то это может быть плохим критерием для поиска соответствий.  

   Сущность/Поле (второй) — атрибут, который будет использоваться для поиска соответствий для второй пары сущностей.

   Нормализовать — **Метод нормализации**: различные варианты нормализации доступны для выбранных атрибутов. Например, удаление знаков препинания или удаление пробелов

   Для нормализации имени организации (предварительная версия) можно также выбрать **Тип (телефон, имя, организация)**

   > [!div class="mx-imgBorder"]
   > ![Нормализация-B2B](media/match-normalization-b2b.png "Нормализация-B2B")

   Уровень точности — уровень точности, который будет использоваться для этого условия. Установка уровня точности для условия соответствия может иметь два типа: **Базовый** и **Пользовательский**.  
   - Базовый: предоставляет четыре варианта на выбор: низкий, средний, высокий и точный. Выберите **Точный**, чтобы сопоставлять только те записи, которые совпадают на 100%. Выберите один из других уровней, чтобы сопоставить записи, которые не идентичны на 100 процентов.
   - Пользовательский: используйте ползунок, чтобы определить пользовательский процент, которому должны соответствовать записи, или введите значение в поле **Пользовательский**. Система будет сопоставлять только записи, превышающие этот порог, как обогащенные совпадающие пары. Значения на ползунке находятся в диапазоне от 0 до 1. Таким образом, 0,64 представляет 64 процента.

3. Выберите **Готово**, чтобы сохранить правило.

### <a name="add-multiple-conditions"></a>Добавление нескольких условий

Чтобы сопоставлять ваши сущности, только если выполняется несколько условий, добавьте больше условий, связанных через оператор AND (И).

1. На панели **Изменить правило** выберите **Добавить условие**. Вы также можете удалить условия, нажав кнопку "Удалить" рядом с существующим условием.

2. Выберите **Готово**, чтобы сохранить правило.

## <a name="add-multiple-rules"></a>Добавление нескольких правил

Каждое условие применяется к одной паре атрибутов, а правила представляют наборы условий. Чтобы поиск соответствия ваших сущностей проводился по разным наборам атрибутов, вы можете добавить больше правил.

1. В аналитике аудитории перейдите **Данные** > **Унификация** > **Соответствие**.

2. Выберите сущность, которую требуется обновить, и выберите **Добавить правила**.

3. Следуйте процедуре, изложенной в разделе [Определение правил для первой пары соответствий](#define-rules-for-your-first-match-pair).

> [!NOTE]
> Порядок правил имеет значение. Алгоритм поиска соответствий пытается найти совпадение на основе вашего первого правила и переходит ко второму правилу, только если в первом правиле не было найдено совпадений.

## <a name="define-deduplication-on-a-match-entity"></a>Определите дедупликацию для соответствующей сущности

Наряду с указанием правил соответствия между сущностями, как описано в приведенных выше разделах, вы также можете указать правила дедупликации. *Дедупликация* — это процесс. Он идентифицирует повторяющиеся записи, объединяет их в одну запись и связывает все исходные записи с этой объединенной записью с альтернативными идентификаторами объединенной записи.

После идентификации дедуплицированной записи эта запись будет использоваться в процессе сопоставления между объектами. Дедупликация реализована на уровне сущности и может применяться ко всем сущностям, используемым в процессе соответствия.

### <a name="add-deduplication-rules"></a>Добавить правила дедупликации

1. В аналитике аудитории перейдите **Данные** > **Унификация** > **Соответствие**.

1. В разделе **Объединенные повторы** выберите **Задать сущности**.

1. В разделе **Параметры объединения** выберите сущности, к которым вы хотите применить дедупликацию.

1. Укажите, как объединить повторяющиеся записи, и выберите один из трех вариантов объединения:
   - *Наиболее заполненные*: определяет запись с наиболее заполненными атрибутами как запись победителя. Это параметр объединения по умолчанию.
   - *Самые новые*: определяет запись победителя на основе "самая новая". Требуется дата или числовое поле для определения давности.
   - *Наименее недавние*: определяет запись победителя на основе "наименее недавние". Требуется дата или числовое поле для определения давности.
 
   > [!div class="mx-imgBorder"]
   > ![Правила дедупликации, шаг 1](media/match-selfconflation.png "Правила дедупликации, шаг 1")
 
1. После выбора сущностей и задания их предпочтений слияния выберите **Создать правило** для определения правил дедупликации на уровне сущности.
   - В списке **Выбрать поле** перечислены все доступные поля этой сущности, для которых вы хотите дедуплицировать исходные данные.
   - Задайте настройки нормализации и точности аналогично тому, как указано в определении соответствия между сущностям.
   - Вы можете определить дополнительные условия, выбрав **Добавить условие**.
 
   > [!div class="mx-imgBorder"]
   > ![Правила дедупликации, шаг 2](media/match-selfconflation-rules.png "Правила дедупликации, шаг 2")

  Можно создать несколько правил дедупликации для сущности. 

1. Теперь при выполнении процесса соответствия записи группируются на основе условий, определенных в правилах дедупликации. После группировки записей для определения победившей записи применяется политика слияния.

1. Эта запись победителя затем передается в сопоставление между сущностями вместе с записями без победителя (например, альтернативными идентификаторами) для повышения качества соответствия.

1. Любые настраиваемые правила сопоставления, определенные для "всегда совпадают" и "никогда не совпадают", отменяют правила дедупликации. Если правило дедупликации идентифицирует совпадающие записи, а настраиваемое правило сопоставления настроено так, чтобы никогда не совпадать с этими записями, то эти две записи не будут сопоставлены.

1. После запуска процесса сопоставления вы увидите статистику дедупликации.
   
> [!NOTE]
> Указание правил дедупликации не является обязательным. Если такие правила не настроены, применяются правила, определенные системой. Они сворачивают все записи с одинаковой комбинацией значений (точное совпадение) из первичного ключа и полей в правилах сопоставления в единую запись перед передачей данных сущности в сопоставление между сущностями для повышения производительности и работоспособности системы.

## <a name="run-your-match-order"></a>Запустите свой порядок поиска соответствий

После определения правил сопоставления, включая правила сопоставления между сущностями и дедупликации, вы можете запустить порядок сопоставления. На странице **Соответствие** выберите **Выполнить**, чтобы начать процесс. Выполнение алгоритма поиска соответствий может занять некоторое время. Вы не можете изменить свойства на странице **Соответствия**, пока не завершится процесс поиска соответствий. Вы найдете сущность единого профиля клиента, которая была создан, на странице **Сущности**. Ваша единая клиентская сущность называется **ConflationMatchPairs : CustomerInsights**.

Для внесения дополнительных изменений и повторного выполнения шага вы можете отменить выполняющийся поиск совпадений. Выберите текст **Обновляется...** и выберите **Отменить задание** внизу боковой панели, которая появляется.

Когда процесс поиска совпадений завершен, текст **Обновляется...** изменится на **Успешно выполнено**, и вы можете снова использовать все функциональные возможности страницы.

Первый процесс сопоставления приводит к созданию единой главной сущности. Все последующие поиски совпадений приводят к расширению этой сущности.

> [!TIP]
> Есть [шесть типов статусов](system.md#status-types) для задач/процессов. Кроме того, большинство процессов [зависит от других последующих процессов](system.md#refresh-policies). Вы можете выбрать статус процесса, чтобы увидеть детали выполнения всего задания. После выбора **См. сведения** для одной из задач задания вы найдете дополнительную информацию: время обработки, дату последней обработки, а также все ошибки и предупреждения, связанные с задачей.

## <a name="deduplication-output-as-an-entity"></a>Выходные данные дедупликации как сущность
В дополнение к единой основной сущности, созданной как часть соответствия между сущностями, в процессе дедупликации также создается новая сущность для каждой сущности из порядка соответствия для идентификации дедуплицированных записей. Эти сущности можно найти вместе с **ConflationMatchPairs:CustomerInsights** в разделе **Система** на странице **Сущности** с именем **Deduplication_Datasource_Entity**.

Сущность выходных данных дедупликации содержит следующую информацию:
- Идентификаторы/ключи
  - Поле первичного ключа и поле его альтернативного идентификатора. Поле альтернативных идентификаторов состоит из всех альтернативных идентификаторов, определенных для записи.
  - Поле Deduplication_GroupId показывает группу или кластер, идентифицированный внутри сущности, который группирует все похожие записи на основе указанных полей дедупликации. Это используется для системной обработки. Если не указаны правила ручной дедупликации и применяются системные правила дедупликации, вы можете не найти это поле в сущности выходных данных дедупликации.
  - Deduplication_WinnerId: это поле содержит идентификатор победителя из идентифицированных групп или кластеров. Если Deduplication_WinnerId совпадает со значением первичного ключа для записи, это означает, что запись является победившей.
- Поля, используемые для определения правил дедупликации.
- Поля «Правило» и «Оценка», чтобы указать, какие из правил дедупликации были применены, и оценка, возвращаемая алгоритмом соответствия.

## <a name="review-and-validate-your-matches"></a>Просмотр и подтверждение ваших совпадений

Оцените качество соответствующих пар и уточните их:

- На странице **Совпадение** вы найдете две плитки, показывающие начальную информацию о ваших данных.

  - **Уникальные клиенты**: показывает количество уникальных профилей, идентифицированных системой.
  - **Совпадающие записи**: показывает количество совпадений во всех ваших парах совпадений.

- В таблице **Порядок соответствия** вы можете оценить результаты каждой пары совпадений, сравнив количество записей, полученных из этой сущности пары совпадений, с процентом успешно сопоставленных записей.

- В разделе **Правила** сущности в таблице **Порядок соответствия** вы найдете процент успешно сопоставленных записей на уровне правил. Выбрав символ таблицы рядом с правилом, вы можете просмотреть все записи на уровне правила. Мы рекомендуем вам просмотреть подмножество записей, чтобы убедиться, что они были сопоставлены правильно.

- Поэкспериментируйте с различными пороговыми значениями точности для ваших условий, чтобы определить оптимальное значение.

  1. Выберите многоточие (...) для правила соответствия пар, с которым вы хотите поэкспериментировать, и выберите **Изменить**.

  2. Выберите условие, с которой вы хотите экспериментировать. Каждый критерий представлен одной строкой на панели **Правило соответствия**.

  3. Что вы увидите на странице **Предварительный просмотр условий**, зависит от уровня точности, который вы выбрали для условия. Найдите количество совпавших и несовпавших записей для выбранного условия.

     Получите глубокое понимание влияния различных пороговых уровней. Вы можете сравнить, сколько записей будет сопоставлено для каждого из пороговых уровней, и просмотреть записи для каждого варианта. Выберите каждую плитку и просмотрите данные в разделе таблицы.

## <a name="optimize-your-matches"></a>Оптимизируйте свои соответствия

Повысьте качество, изменив некоторые параметры соответствия:

- **Измените порядок поиска соответствий**, выбрав **Изменить** и изменив порядок поиска соответствий полей.

  > [!div class="mx-imgBorder"]
  > ![Изменение порядка поиска соответствия данных](media/configure-data-match-order-edit.png "Изменение порядка поиска соответствия данных")

- **Измените порядок ваших правил**, если вы определили несколько правил. Вы можете изменить порядок соответствия, выбрав параметры **Вверх** и **Вниз** в сетке правил соответствия.

  > [!div class="mx-imgBorder"]
  > ![Изменение порядка правил](media/configure-data-change-rule-order.png "Изменение порядка правил")

- **Дублируйте свои правила**, если вы определили правило соответствия и хотели бы создать аналогичное правило с изменениями. Сделайте это, выбрав **Дублировать**.

  > [!div class="mx-imgBorder"]
  > ![Дублирование правила](media/configure-data-duplicate-rule.png "Дублирование правила")

- **Деактивировать правило**, чтобы сохранить правило соответствия, исключив его из процесса соответствия.

  > [!div class="mx-imgBorder"]
  > ![Деактивация правила](media/configure-data-deactivate-rule.png "Деактивация правила")

- **Измените ваши правила**, выбрав символ **Изменить**. Можно применить следующие изменения:

  - Измените атрибуты для условия: выберите новые атрибуты в строке конкретного условия.
  - Измените порог для условия: отрегулируйте ползунок точности.
  - Измените метод нормализации для условия: обновите метод нормализации.

## <a name="specify-your-custom-match-records"></a>Укажите свои собственные записи соответствия

Вы можете указать условия, что отдельные записи должны всегда соответствовать или никогда не должны соответствовать. Эти правила могут быть загружены в пакетном режиме в процесс поиска совпадений.

1. Выберите параметр **Пользовательское соответствие** на экране **Порядок соответствия**.

   > [!div class="mx-imgBorder"]
   > ![Создание настраиваемого соответствия](media/custom-match-create.png "Создание настраиваемого соответствия")

2. Если у вас нет загруженных сущностей, вы увидите новое диалоговое окно **Пользовательское соответствие**, которое требует от вас заполнить некоторые детали. Если вы уже предоставили эти данные ранее, перейдите к шагу 8.

   > [!div class="mx-imgBorder"]
   > ![Диалоговое окно нового настраиваемого соответствия](media/custom-match-new-dialog-box.png "Диалоговое окно нового настраиваемого соответствия")

3. Выберите **Заполните шаблон**, чтобы получить файл шаблона, в котором можно указать, какие записи из каких сущностей всегда должны совпадать или никогда не должны совпадать. Вам нужно будет отдельно заполнить записи "всегда совпадают" и "никогда не совпадают" в двух разных файлах.

4. Шаблон содержит поля для указания значений сущности и первичного ключа сущности, которые будут использоваться в пользовательском соответствии. Например, если вы хотите, чтобы первичный ключ 12345 из сущности "Продажи" всегда совпадал с первичным ключом 34567 из сущности "Контакт", вам необходимо указать следующее:
    - Entity1: Продажи
    - Entity1Key: 12345
    - Entity2: Контакт
    - Entity2Key: 34567

   В одном файле шаблона можно указывать пользовательские записи совпадений из нескольких сущностей.
   
   Если вы хотите указать настраиваемое соответствие для дедупликации в сущности, укажите ту же сущность, что и Entity1 и Entity2, и установите разные значения первичного ключа.

5. После добавления всех переопределений, которые вы хотите применить, сохраните файл шаблона.

6. Перейдите **Данные** > **Источники данных** и примите файлы шаблонов как новые сущности. После приема вы можете использовать их, чтобы указать конфигурацию соответствия.

7. После того как отправленные файлы и сущностей доступны, выберите параметр **Пользовательское соответствие** снова. Вы увидите опции для указания сущностей, которые вы хотите включить. Выберите требуемые сущности из раскрывающегося меню.

   > [!div class="mx-imgBorder"]
   > ![Переопределения пользовательского соответствия](media/custom-match-overrides.png "Переопределения пользовательского соответствия")

8. Выберите сущности, которые вы хотите использовать для **Всегда должны соответствовать** и **Никогда не соответствуют**, выберите **Готово**.

9. Выберите **Сохранить** на странице **Соответствие** для пользовательской конфигурации соответствия, которую вы только что настроили.

10. Выберите **Выполнить** на странице **Соответствие**, чтобы начать процесс поиска соответствий, и пользовательская конфигурация соответствия будет введена в действие. Любые правила, подобранные системой, переопределяются набором конфигурации.

11. После завершения поиска соответствий вы можете проверить сущность **ConflationMatchPair**, чтобы подтвердить, что переопределения применяются в обогащенных соответствиях.

## <a name="next-step"></a>Следующий шаг

После завершения процесса поиска соответствий хотя бы для одной пары соответствия вы можете разрешить возможные противоречия в своих данных, выполнив действия из темы [**Объединение**](merge-entities.md).


[!INCLUDE[footer-include](../includes/footer-banner.md)]