---
title: Соответствие сущностей для унификации данных
description: Найдите совпадения сущностей для создания унифицированных профилей клиентов.
ms.date: 02/23/2021
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
ms.openlocfilehash: 7ad08b8b782654939c6bfc2ca330a3d31e71054a2f2c97a921971d1056b7cd38
ms.sourcegitcommit: aa0cfbf6240a9f560e3131bdec63e051a8786dd4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/10/2021
ms.locfileid: "7033693"
---
# <a name="match-entities"></a>Поиск совпадений сущностей

На этапе соответствия указывается, как объединить наборы данных в единый набор данных профиля клиента. После завершения [этапа сопоставления](map-entities.md) в процессе объединения данных вы можете сопоставить свои сущности. Фаза соответствия требует по крайней мере двух сопоставленных сущностей.

Страница сопоставления состоит из трех разделов: 
- Ключевые метрики, определяющие количество сопоставленных записей
- Порядок сопоставления и правила сопоставления между сущностями
- Правила дедупликации сопоставленных сущностей

## <a name="specify-the-match-order"></a>Задание порядка установления соответствия

Перейдите **Данные** > **Объединить** > **Соответствие** и выберите **Задать порядок**, чтобы начать фазу соответствия.

Каждое сопоставление объединяет две или более сущности в одну консолидированную сущность. В то же время в нем хранятся уникальные записи клиентов. Например, мы выбрали две сущности: **eCommerce:eCommerceContacts** в качестве основной и **LoyaltyScheme:loyCustomers** в качестве дополнительной. Порядок сущностей указывает на то, в какой последовательности система будет пытаться сопоставить записи.

:::image type="content" source="media/match-page.png" alt-text="Снимок экрана страницы &quot;Сопоставление&quot; в области &quot;Объединение&quot; процесса объединения данных.":::
  
Основная сущность *eCommerce:eCommerceContacts* сопоставлена со следующей сущностью *LoyaltyScheme:loyCustomers*. Набор данных, полученный в результате первого шага сопоставления, сопоставляется со следующей сущностью, если у вас их более двух.

> [!IMPORTANT]
> Сущность, которую вы выбираете в качестве основной будет служить основой для вашего набора данных единых профилей. К этому объекту будут добавлены дополнительные объекты, выбранные на этапе соответствия. Это не означает, что объединенная сущность будет включать *все* данные, включенные в эту сущность.
>
> Есть два соображения, которые могут помочь вам выбрать иерархию ваших сущностей:
>
> - В качестве основной выберите сущность с наиболее полными и надежными данными профиля о ваших клиентах.
> - Выберите в качестве основной сущность, в которой несколько атрибутов совпадают с другими сущностями (например, имя, номер телефона или адрес электронной почты).

После указания порядка сопоставления вы увидите определенные пары совпадений в разделе **Сведения о сопоставленных записях** (**Данные** > **Объединение** > **Сопоставление**). Ключевые метрики будут пустыми до завершения процесса сопоставления.

## <a name="define-rules-for-match-pairs"></a>Определите правила сопоставления

Правила соответствия определяют логику, по которой будет производиться поиск соответствий в определенной паре сущностей.

Предупреждение **Нужны правила** рядом с именем сущности означает, что для сопоставляемой пары не определено правило сопоставления. 

:::image type="content" source="media/match-rule-add.png" alt-text="Снимок экрана раздела сведений о сопоставленной записи с выделенным элементом управления для добавления правил.":::

1. Выберите **Добавить правила** под сущностью в разделе **Сведения о сопоставленных записях** для определения правил сопоставления.

1. В области **Создать правило** настройте условия для правила.

   :::image type="content" source="media/match-rule-conditions.png" alt-text="Скриншот открытого правила сопоставления с добавленными условиями.":::

   - **Сущность/Поле (первая строка)**: выберите связанную сущность и атрибут, чтобы указать свойство записи, которое, вероятно, является уникальным для клиента. Например, номер телефона или адрес электронной почты. Избегайте сопоставления по атрибутам типа действия. Например, ИД покупки, скорее всего, не найдет соответствия в других типах записей.

   - **Сущность/Поле (вторая строка)**: выберите атрибут, который относится к атрибуту сущности, указанной в первой строке.

   - **Нормализация**: выберите из следующих вариантов нормализации для выбранных атрибутов. 
     - Пробел: удаляет все пробелы. *Hello   World* становится *HelloWorld*.
     - Символы: удаляет все символы и специальные знаки. *Head&Shoulder* становится *HeadShoulder*.
     - Текст в нижний регистр: переводит все символы в нижний регистр. *ВСЕ ЗАГЛАВНЫЕ БУКВЫ и Капитализация Начальных Букв* становится *все заглавные буквы и капитализация начальных Букв*.
     - Unicode в ASCII: преобразует обозначение Unicode в символы ASCII. */u00B2* становится *2*.
     - Числительные: преобразует другие числовые системы, например римские цифры, в арабские. *VIII* становится *8*.
     - Семантические типы: стандартизирует имена, заголовки, номера телефонов, адреса и т. д. 

   - **Точность**: установите уровень точности, чтобы иметь доступ к этому условию. 
     - **Базовый**: выберите *Низкий*, *Средний*, *Высокий*, и *Точный*. Выберите **Точный**, чтобы сопоставлять только те записи, которые совпадают на 100%. Выберите один из других уровней, чтобы сопоставить записи, которые не идентичны на 100 процентов.
     - **Пользовательский**: задайте процент, которому должны соответствовать записи. Система будет сопоставлять только записи, превышающие этот порог.

1. Задайте **Имя** для правила.

1. [Добавьте дополнительные условия](#add-conditions-to-a-rule) или выберите **Выполнено**, чтобы завершить создание правила.

1. Вы также можете (необязательно) [добавить дополнительные правила](#add-rules-to-a-match-pair).

1. Нажмите кнопку **Сохранить**, чтобы применить изменения.

### <a name="add-conditions-to-a-rule"></a>Добавление условий для правила

Чтобы сопоставлять сущности только в случае соответствия атрибутов нескольким условиям, добавьте дополнительные условия в правило сопоставления. Условия связаны с помощью логического оператора "И", поэтому выполнение происходит только при соблюдении всех условий.

1. Выберите **Данные** > **Объединение** > **Сопоставление** , а затем — **Редактировать** на правиле, к которому вы хотите добавить условия.

1. На панели **Изменить правило** выберите **Добавить условие**.

1. Выберите **Готово**, чтобы сохранить правило.

### <a name="add-rules-to-a-match-pair"></a>Добавление правила в сопоставляемую пару

Правила соответствия представляют собой наборы условий. Чтобы сопоставлять сущности по условиям на основе нескольких атрибутов, добавляйте дополнительные правила.

1.  Выберите **Данные** > **Объединение** > **Сопоставление** , а затем — **Добавить правило** на сущности, к которой вы хотите добавить правила.

2. Следуйте инструкциям в разделе [Определение правил для сопоставляемых пар](#define-rules-for-match-pairs).

> [!NOTE]
> Порядок правил имеет значение. Алгоритм сопоставления сначала работает на основе вашего первого правила, а затем переходит ко второму правилу только в том случае, если не обнаружены соответствия по первому правилу.

### <a name="change-the-entity-order-in-match-rules"></a>Изменение порядка сущностей в правилах сопоставления

Вы можете изменить порядок сущностей для правил сопоставления, чтобы изменить порядок их обработки. Правила, конфликтующие из-за изменения порядка, будут удалены. Вам необходимо воссоздать удаленные правила с обновленной конфигурацией.

1. Перейдите в раздел **Данные** > **Унифицировать** > **Сопоставление** и выберите **Изменить**.

1. В области **Изменить правило** выберите элемент управления **Переместить вверх/вниз** и перетаскивайте сущности, чтобы изменить порядок.

   :::image type="content" source="media/reorder-match-rules.png" alt-text="Параметры для изменения порядка обработки сущностей на этапе сопоставления.":::

1. Выберите **Готово**, чтобы сохранить правило.

## <a name="define-deduplication-on-a-match-entity"></a>Определите дедупликацию для соответствующей сущности

В добавление к [правилам сопоставления между сущностями](#define-rules-for-match-pairs), вы также можете указать правила дедупликации. *Дедупликация* — это еще один процесс при сопоставлении записей. Он определяет повторяющиеся записи и объединяет их в одну запись. Исходные записи связываются с объединенной записью с альтернативными идентификаторами.

Дедуплицированные записи будут использоваться в процессе сопоставления между сущностями. Дедупликация происходит на отдельных сущностях и может быть настроена для каждой сущности, используемой в сопоставляемых парах.

Указание правил дедупликации не является обязательным. Если такие правила не настроены, применяются правила, определенные системой. Они объединяют все записи в единую запись перед передачей данных сущности для сопоставления с целью повышения эффективности.

### <a name="add-deduplication-rules"></a>Добавить правила дедупликации

1. Выберите **Данные** > **Объединение** > **Сопоставление**.

1. В разделе **Объединенные повторы** выберите **Задать сущности**. Если правила дедупликации уже созданы, выберите **Редактировать**.

1. В разделе **Параметры объединения** выберите сущности, к которым вы хотите применить дедупликацию.

1. Укажите, как объединить повторяющиеся записи, и выберите один из трех вариантов:
   - **Наиболее заполненные**: определяет запись с наиболее заполненными полями атрибутов в качестве записи победителя. Это параметр объединения по умолчанию.
   - **Самые новые**: определяет запись победителя на основе "самая новая". Требуется дата или числовое поле для определения давности.
   - **Наименее недавние**: определяет запись победителя на основе "наименее недавние". Требуется дата или числовое поле для определения давности.
 
   > [!div class="mx-imgBorder"]
   > ![Правила дедупликации, шаг 1.](media/match-selfconflation.png "Правила дедупликации, шаг 1")
 
1. После выбора сущностей и задания их предпочтений слияния выберите **Добавить правило** для определения правил дедупликации на уровне сущности.
   - **Выбрать поле**: указываются все доступные поля из этой сущности. Выберите поле, которое вы хотите проверить на наличие дубликатов. Выберите поля, которые, вероятно, уникальны для каждого клиента. Например, адрес электронной почты или комбинация имени, города и номера телефона.
   - Задайте настройки нормализации и точности.
   - Укажите дополнительные условия, выбрав **Добавить условие**.
 
   > [!div class="mx-imgBorder"]
   > ![Правила дедупликации, шаг 2.](media/match-selfconflation-rules.png "Правила дедупликации, шаг 2")

  Можно создать несколько правил дедупликации для сущности. 

1. Теперь при выполнении процесса соответствия записи группируются на основе условий, определенных в правилах дедупликации. После группировки записей для определения победившей записи применяется политика слияния.

1. Эта запись победителя затем передается в сопоставление между сущностями вместе с записями без победителя (например, альтернативными идентификаторами) для повышения качества соответствия.

1. Любые пользовательские правила сопоставления перезаписывают правила дедупликации. Если правило дедупликации идентифицирует совпадающие записи, а настраиваемое правило сопоставления настроено так, чтобы никогда не совпадать с этими записями, то эти две записи не будут сопоставлены.

1. После [запуска процесса сопоставления](#run-the-match-process) вы увидите статистику дедупликации на плитках ключевых метрик.

### <a name="deduplication-output-as-an-entity"></a>Выходные данные дедупликации как сущность

Процесс дедупликации создает новую сущность для каждой сущности из пар совпадений, чтобы идентифицировать дедуплицированные записи. Эти сущности можно найти вместе с **ConflationMatchPairs:CustomerInsights** в разделе **Система** на странице **Сущности** с именем **Deduplication_DataSource_Entity**.

Сущность выходных данных дедупликации содержит следующую информацию:
- Идентификаторы/ключи
  - Поле первичного ключа и поле его альтернативного идентификатора. Поле альтернативных идентификаторов состоит из всех альтернативных идентификаторов, определенных для записи.
  - Поле Deduplication_GroupId показывает группу или кластер, идентифицированный внутри сущности, который группирует все похожие записи на основе указанных полей дедупликации. Это используется для системной обработки. Если не указаны правила ручной дедупликации и применяются системные правила дедупликации, вы можете не найти это поле в сущности выходных данных дедупликации.
  - Deduplication_WinnerId: это поле содержит идентификатор победителя из идентифицированных групп или кластеров. Если Deduplication_WinnerId совпадает со значением первичного ключа для записи, это означает, что запись является победившей.
- Поля, используемые для определения правил дедупликации.
- Поля «Правило» и «Оценка», чтобы указать, какие из правил дедупликации были применены, и оценка, возвращаемая алгоритмом соответствия.
   
## <a name="run-the-match-process"></a>Запуск процесса сопоставления

После настройки правил сопоставления, включая правила сопоставления между сущностями и дедупликации, вы можете запустить процесс сопоставления. 

Выберите **Данные** > **Объединение** > **Сопоставление**, а затем нажмите **Запустить**, чтобы начать процесс. Алгоритм сопоставления занимает некоторое время, и вы не можете изменить конфигурацию, пока он не будет завершен. Чтобы внести изменения, нужно отменить выполнение процесса. Выберите статус задания и выберите **Отменить задание** в области **Сведения о ходе выполнения**.

Вы найдете результат успешного запуска, объединенную сущность профиля клиента, на странице **Сущности**. Ваша объединенная сущность клиента называется **Клиенты** в разделе **Профили**. Первый успешный запуск сопоставления создает объединенную сущность *Клиент*. Все последующие сопоставления расширяют эту сущность.

> [!TIP]
> После запуска процесса сопоставления выберите статус процесса, чтобы открыть область **Сведения о задаче**. Она дает обзор времени обработки, даты последней обработки, а также всех ошибок и предупреждений, связанных с задачей. Выберите **Показать подробности**, чтобы узнать, какие сущности участвовали в процессе сопоставления, какие правила были применены к ним и были ли обновления опубликованы успешно.  
> Есть [шесть типов статусов](system.md#status-types) для задач/процессов. Кроме того, большинство процессов [зависит от других последующих процессов](system.md#refresh-policies).  
> :::image type="content" source="media/process-detail-path.png" alt-text="Путь детализации, чтобы перейти к сведениям о процессах по ссылке статуса задачи.":::

## <a name="review-and-validate-your-matches"></a>Просмотр и подтверждение ваших совпадений

Выберите **Данные** > **Объединение** > **Сопоставление**, чтобы оценить качество ваших пар совпадений и при необходимости уточнить их.

Плитки в верхней части страницы отображают ключевые метрики с указанием количества сопоставленных записей и дубликатов.

:::image type="content" source="media/match-KPIs.png" alt-text="Обрезанный снимок экрана с ключевыми метриками на странице сопоставление с числами и подробными сведениями.":::

- **Уникальные исходные записи** — количество отдельных исходных записей, обработанных при последнем сопоставлении.
- **Сопоставленные и несопоставленные записи**: указывается количество уникальных записей, которые остались после обработки правил сопоставления.
- **Только сопоставленные записи** показывает количество соответствий по всем парам.

Вы можете оценить результаты каждой пары совпадений и ее правила в таблице **Сведения о сопоставленных записях**. Сравните количество записей, полученных из пары совпадений, с процентом успешно сопоставленных записей.

Просмотрите правила пары совпадений, чтобы увидеть процент успешно сопоставленных записей на уровне правила. Нажмите на многоточие (...), а затем выберите **Предварительный просмотр соответствия** для просмотра всех этих записей на уровне правила. Мы рекомендуем вам взглянуть на некоторые записи, чтобы убедиться, что они правильно сопоставлены.

Попробуйте разные пороги точности для условий, чтобы найти оптимальное значение.

  1. Нажмите на многоточие (...) для правила, с которым вы хотите поэкспериментировать, и выберите **Редактировать**.

  2. Измените значения точности в условиях, которые вы хотите откорректировать.

  3. Выберите **Предварительный просмотр**, чтобы увидеть количество сопоставленных и несопоставленных записей для выбранного условия.

## <a name="manage-match-rules"></a>Управление правилами сопоставления

Вы можете перенастроить и уточнить большинство параметров сопоставления.

:::image type="content" source="media/match-rules-management.png" alt-text="Снимок экрана раскрывающегося меню с параметрами правила соответствия.":::

- **Измените порядок ваших правил**, если вы определили несколько правил. Вы можете изменить порядок правил сопоставления с помощью кнопок **Вверх** и **Вниз** или перетаскивания.

- **Измените условия правила**, выбрав **Редактировать** и укажите разные поля.

- **Деактивировать правило**, чтобы сохранить правило соответствия, исключив его из процесса соответствия.

- **Дублируйте свои правила**, если вы определили правило сопоставления и хотите создать аналогичное правило с изменениями. Для этого выберите **Дубликат**.

- **Удалите правило**, выбрав значок **Удалить**.

## <a name="specify-custom-match-conditions"></a>Укажите пользовательские условия сопоставления

Вы можете указать условия, что отдельные записи должны всегда соответствовать или никогда не должны соответствовать. Эти правила могут быть загружены для отмены стандартного процесса сопоставления. Например, если в наших записях есть Джон Доу I и Джон Доу II, система может сопоставить их как одного человека. Пользовательские правила сопоставления позволяют указать, что их профили относятся к разным людям. 

1. Нажмите **Данные** > **Объединение** > **Сопоставление** и выберите **Пользовательское сопоставление** в разделе **Сведения о сопоставленных записях**.

  :::image type="content" source="media/custom-match-create.png" alt-text="Снимок экрана раздела правил сопоставления с выделенным элементом управления для пользовательского сопоставления.":::

1. Если у вас не заданы правила пользовательского сопоставления, вы увидите новую область **Пользовательское сопоставление** с более подробной информацией.

1. Выберите **Заполните шаблон**, чтобы получить файл шаблона, в котором можно указать, какие записи из каких сущностей всегда должны совпадать или никогда не должны совпадать. Вам нужно будет отдельно заполнить записи "всегда совпадают" и "никогда не совпадают" в двух разных файлах.

1. Шаблон содержит поля для указания значений сущности и первичного ключа сущности, которые будут использоваться в пользовательском соответствии. Например, если вам нужно, чтобы первичный ключ *12345* из сущности *Продажи*, всегда соответствовал первичному ключу *34567* из сущности *Контакт*, заполните шаблон:
    - Entity1: Продажи
    - Entity1Key: 12345
    - Entity2: Контакт
    - Entity2Key: 34567

   В одном файле шаблона можно указывать пользовательские записи совпадений из нескольких сущностей.
   
   Если вы хотите указать настраиваемое соответствие для дедупликации в сущности, укажите ту же сущность, что и Entity1 и Entity2, и установите разные значения первичного ключа.

1. После добавления всех переопределений, которые вы хотите применить, сохраните файл шаблона.

1. Перейдите **Данные** > **Источники данных** и примите файлы шаблонов как новые сущности. После приема вы можете использовать их, чтобы указать конфигурацию соответствия.

1. После того как отправленные файлы и сущностей доступны, выберите параметр **Пользовательское соответствие** снова. Вы увидите опции для указания сущностей, которые вы хотите включить. Выберите необходимые сущности из раскрывающегося меню.

   :::image type="content" source="media/custom-match-overrides.png" alt-text="Снимок экрана диалогового окна для выбора переопределений для пользовательского сценария сопоставления.":::

1. Выберите сущности, которые вы хотите использовать для **Всегда должны соответствовать** и **Никогда не соответствуют**, выберите **Готово**.

1. Выберите **Сохранить** на странице **Сопоставление**, чтобы применить пользовательскую конфигурацию сопоставления.

1. Выберите **Запуск** на странице **Сопоставление**, чтобы начать процесс сопоставления. Другие указанные правила сопоставления переопределяются настраиваемой конфигурацией сопоставления.

> [!TIP]
> Выберите **Данные** > **Сущности** и проверьте сущность **ConflationMatchPair**, чтобы убедиться в применении переопределений.

## <a name="next-step"></a>Следующий шаг

После завершения процесса поиска соответствий хотя бы для одной пары соответствия вы можете разрешить возможные противоречия в своих данных, выполнив действия из темы [**Объединение**](merge-entities.md).


[!INCLUDE[footer-include](../includes/footer-banner.md)]
