---
title: Отношения между сущностями и путями сущностей
description: Создавайте и управляйте отношениями между сущностями из нескольких источников данных.
ms.date: 09/27/2021
ms.reviewer: mhart
ms.subservice: audience-insights
ms.topic: conceptual
author: CadeSanthaMSFT
ms.author: cadesantha
manager: shellyha
searchScope:
- ci-semantic-mapping
- ci-entities
- ci-relationships
- ci-activities
- ci-activities-wizard
- ci-measures
- ci-segments
- ci-segment-builder
- ci-measure-builder
- ci-measure-template
- ci-permissions
- customerInsights
ms.openlocfilehash: db8822aa9e89afb9dc16428af6ca202de789ba1c
ms.sourcegitcommit: 73cb021760516729e696c9a90731304d92e0e1ef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/25/2022
ms.locfileid: "8355721"
---
# <a name="relationships-between-entities"></a>Отношения между сущностями

Отношения соединяют сущности и определяют график ваших данных, когда сущности имеют общий идентификатор, внешний ключ. На этот внешний ключ можно ссылаться от одной сущности к другой. Связанные сущности позволяют определять сегменты и меры на основе нескольких источников данных.

Есть три типа отношений: 
- Нередактируемые системные отношения, созданные системой в рамках процесса объединения данных
- Нередактируемые унаследованные отношения, которые создаются автоматически из источников данных 
- Редактируемые пользовательские отношения, созданные и настроенные пользователями

## <a name="non-editable-system-relationships"></a>Нередактируемый системные отношения

Во время объединения данных системные отношения создается автоматически на основе интеллектуального сопоставления. Эти отношения помогают связать записи профиля клиента с соответствующими записями. На следующей диаграмме показано создание трех системных отношений. Сущности клиента сопоставляется с другими сущностями для производства единой сущности *Клиент*.

:::image type="content" source="media/relationships-entities-merge.png" alt-text="Диаграмма с путями отношений для сущности клиента с тремя отношениями 1-N.":::

- ***CustomerToContact*— отношение** было создано между сущностью *Клиент* и сущностью *Контакт*. Сущность *Клиент* получает ключевое поле **Contact_contactID** для связи с ключевым полем сущности *Контакт* **contactID**.
- ***CustomerToAccount* — отношение** было создано между сущностью *Клиент* и сущностью *Организация*. Сущность *Клиент* получает ключевое поле **Account_accountID** для связи с ключевым полем сущности *Организация* **accountID**.
- ***CustomerToWebAccount*— отношение** было создано между сущностью *Клиент* и сущностью *WebAccount*. Сущность *Клиент* получает ключевое поле **WebAccount_webaccountID** для связи с ключевым полем сущности *WebAccount* **webaccountID**.

## <a name="non-editable-inherited-relationships"></a>Нередактируемые унаследованные отношения

В процессе приема данных система проверяет источники данных на наличие отношений. Если отношений не существует, система автоматически создает их. Эти отношения также используются в последующих процессах.

## <a name="create-a-custom-relationship"></a>Создание настраиваемого отношения

Отношения состоят из *исходной сущности*, содержащей внешний ключ, и *целевой сущности*, на которую указывает внешний ключ исходной сущности. 

1. В аналитике аудитории перейдите **Данные** > **Отношения**.

2. Выберите **Создать отношение**.

3. В области **Новое отношение** укажите следующие сведения:

   :::image type="content" source="media/relationship-add.png" alt-text="Боковая панель создания отношений с пустыми полями ввода.":::

   - **Имя отношения**: имя, которое отражает цель отношений. Пример: CustomerToSupportCase.
   - **Описание**: описание отношения.
   - **Исходная сущность**: сущность, которая используется в качестве источника в отношении. Пример: SupportCase.
   - **Целевая сущность**: сущность, которая используется в качестве цели в отношении. Пример: Customer.
   - **Кратность исходной сущности**: кратность исходной сущности. Количество элементов описывает количество возможных элементов в наборе. Это всегда относится к кратности исходной сущности. Вы можете выбирать между **Один** и **Много**. Поддерживаются только отношения многие-к-одному и один-к-одному.  
     - Многие-к-одному: несколько исходных записей могут относиться к одной целевой записи. Пример: несколько обращений в службу поддержки от одного клиента.
     - Один к одному: одна исходная запись связана с одной целевой записью. Пример: один идентификатор лояльности для одного клиента.

     > [!NOTE]
     > Отношения "многие ко многим" можно создать с использованием двух отношений "многие ко многим" и связывающей сущности, которая соединяет исходную сущность и целевую сущность.

   - **Кратность целевого объекта**: выберите кратность записей целевой сущности. 
   - **Поле исходного ключа**: поле внешнего ключа в исходной сущности. Пример: SupportCase может использовать CaseID в качестве поля внешнего ключа.
   - **Целевое ключевое поле**: поле ключа целевой сущности. Пример Customer может использовать ключевое поле **CustomerID**.

4. Нажмите кнопку **Сохранить**, чтобы сохранить настраиваемое отношение.

## <a name="set-up-account-hierarchies"></a>Настройка иерархий организаций

Среды, настроенные для использования организаций в качестве основной целевой аудитория, могут настраивать иерархии организаций для связанных организаций. Например, компания, у которой есть отдельные бизнес-единицы. 

Организации создают иерархии организаций, чтобы лучше управлять организациями и их отношения друг с другом. Возможность аналитики аудитория поддерживает иерархии родительских и дочерних организаций, которые уже существуют во введенных данных о клиентах. Например, организации из Dynamics 365 Sales. Эти иерархии можно настроить на странице **Отношения** в аналитике аудитории на вкладке иерархии организаций.

1. Перейдите **Данные** > **Отношения**.
1. Выберите вкладку **Иерархия организаций**.
1. Выберите **Создать иерархию организаций**. 
1. В области **Иерархия организаций** укажите имя иерархии. Система создает имя для выходной сущности Вы можете изменить имя выходной сущности.
1. Выберите сущностью, содержащую вашу иерархию организаций. Обычно это та же сущность, которая содержит организации.
1. Выберите **Идентификатор организации** и **Идентификатор родительской организации** из выбранной сущности 
1. Выберите **Сохранить**, чтобы применить настройки и завершить иерархию организаций.

## <a name="view-relationships"></a>Просмотр отношений

На странице отношений перечислены все созданные отношения. Каждая строка представляет отношение, которое также включает сведения об исходной сущности, целевой сущности и кратности. 

:::image type="content" source="media/relationships-list.png" alt-text="Список отношений и параметров на панели действий на странице отношений.":::

На этой странице предлагается набор параметров для существующего и нового отношения: 
- **Новые отношения**: [создайте настраиваемые отношения](#create-a-custom-relationship).
- **Визуализатор**: [изучите визуализатор отношений](#explore-the-relationship-visualizer), чтобы увидеть сетевую диаграмму существующих отношений и их кратность.
- **Фильтровать по**: выберите тип отношений для отображения в списке.
- **Искать отношения**: используйте текстовый поиск по свойствам отношений.

### <a name="explore-the-relationship-visualizer"></a>Изучите визуализатор отношений

Визуализатор отношений показывает сетевую диаграмму существующих отношений между подключенными сущностями и их кратность. Он также визуализирует путь отношений.

Чтобы настроить вид, вы можете изменить положение полей, перетащив их на холст.

:::image type="content" source="media/relationship-visualizer.png" alt-text="Снимок экрана сетевой диаграммы визуализатора отношений со связями между подключенными сущностями.":::

Доступные параметры: 
- **Экспорт как изображение**: сохранить текущий вид как файл изображения.
- **Изменить на горизонтальный/вертикальный макет**: изменить выравнивание сущностей и отношений.
- **Редактировать**: обновите свойства пользовательского отношения на панели редактирования и сохраните изменения.

## <a name="relationship-paths"></a>Пути к отношениям

Путь отношения описывает сущности, которые связаны с отношениями между исходной сущностью и целевой сущностью. Он используется при создании сегмента или меры, которая включает в себя другие сущности, кроме сущности единого профиля, и существует несколько вариантов достижения сущности единого профиля. 

Путь отношения сообщает системе, через какие отношения получить доступ к сущности единого профиля. Различные пути отношений могут дать разные результаты.

Например, сущность *eCommerce_eCommercePurchases* имеет следующие отношения в сущности *Клиент* единого профиля:

- eCommerce_eCommercePurchases > Клиент
- eCommerce_eCommercePurchases > eCommerce_eCommerceContacts > POS_posPurchases > Клиент
- eCommerce_eCommercePurchases > eCommerce_eCommerceContacts > POS_posPurchases > loyaltyScheme_loyCustomers > Клиент 

Путь отношения определяет, какие сущности вы можете использовать при создании правил для показателей или сегментов. Выбор варианта с самым длинным путем отношений, вероятно, даст меньше результатов, потому что совпадающие записи должны быть частью всех сущностей. В этом примере клиент должен приобрести товары через канал электронной торговли (eCommerce_eCommercePurchases), в POS (POS_posPurchases) и участвовать в нашей программе лояльности (loyaltyScheme_loyCustomers). Выбирая первый вариант, вы, вероятно, получите больше результатов, потому что клиенты должны существовать только в одной дополнительной сущности.

### <a name="direct-relationship"></a>Прямое отношение

Отношение классифицируется как **прямое отношение**, когда исходная сущность связана с целевой сущностью только одним отношением.

Например, если сущность действия под названием *eCommerce_eCommercePurchases* подключается к целевой сущности *eCommerce_eCommerceContacts* только через *ContactId*, это прямое отношение.

:::image type="content" source="media/direct_Relationship.png" alt-text="Исходная сущность напрямую связана с целевой сущностью.":::

#### <a name="multi-path-relationship"></a>Отношение с несколькими путями

**Отношение с несколькими путями** — это особый тип прямого отношения, которое связывает исходную сущность с более чем одной целевой сущностью.

Например, если сущность действия под названием *eCommerce_eCommercePurchases* связана к двум целевым сущностями, *eCommerce_eCommerceContacts* и *loyaltyScheme_loyCustomers*, это отношение с несколькими путями.

:::image type="content" source="media/multi-path_relationship.png" alt-text="Исходная сущность напрямую связана к несколькими целевыми сущностями через многозвенное отношение.":::

### <a name="indirect-relationship"></a>Непрямое отношение

Отношение классифицируется как **непрямое отношение**, когда исходная сущность связана с одной или несколькими дополнительными сущностями, прежде чем будет связана с целевой сущностью.

#### <a name="multi-hop-relationship"></a>Многозвенное отношение

*Многозвенное отношение* является *непрямым отношением*, который позволяет вам соединять исходную сущность к целевой сущностью через одну или несколько других промежуточных сущностей.

Например, если сущность действия под названием *eCommerce_eCommercePurchasesWest* подключается к промежуточной сущности под названием *eCommerce_eCommercePurchasesEast*, а затем подключается к целевой сущности, называемой *eCommerce_eCommerceContacts*, это многозвенное отношение.

:::image type="content" source="media/multi-hop_relationship.png" alt-text="Исходная сущность напрямую подключается к целевой сущности с промежуточной сущностью.":::

### <a name="multi-hop-multi-path-relationship"></a>Многозвенное отношение с несколькими путями

Многозвенные отношения и отношения с несколькими путями можно использовать вместе для создания **многозвенных отношений с несколькими путями**. Этот специальный тип сочетает в себе функции **многозвенных отношений** и **отношений с несколькими путями**. Он позволяет подключаться к нескольким целевым сущностям при использовании промежуточных сущностей.

Например, если сущность действия под названием *eCommerce_eCommercePurchasesWest* подключается к промежуточной сущности под названием *eCommerce_eCommercePurchasesEast*, а затем подключается к двум целевым сущностям, называемым *eCommerce_eCommerceContacts* и *loyaltyScheme_loyCustomers*, это многозвенное отношение с несколькими путями.

:::image type="content" source="media/multi-hop_multi-path_relationship.png" alt-text="Исходная сущность подключается непосредственно к одной целевой сущности и подключается к другой целевой сущности через промежуточную сущность.":::

## <a name="manage-existing-relationships"></a>Управлять существующим отношениями 

На странице отношений каждое отношение представлено строкой. 

Выберите отношения и выберите один из следующих вариантов: 
 
- **Редактировать**: обновите свойства пользовательского отношения на панели редактирования и сохраните изменения.
- **Удалить**: удалить пользовательское отношение.
- **Просмотр**: просмотреть созданное и унаследованное системное отношение. 

## <a name="next-step"></a>Следующий шаг

Системные и настраиваемые отношения используются для [создания сегментов](segments.md) и [мер](measures.md) на основе нескольких источников данных, которые больше не изолированы.

[!INCLUDE[footer-include](../includes/footer-banner.md)]
