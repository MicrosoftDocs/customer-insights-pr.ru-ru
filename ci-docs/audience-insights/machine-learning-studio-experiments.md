---
title: Эксперименты со студией машинного обучения (классическая версия)
description: Используйте модели студии машинного обучения (классическая версия) в Dynamics 365 Customer Insights.
ms.date: 12/03/2020
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: m-hartmann
ms.author: ameetj
ms.reviewer: mhart
manager: shellyha
ms.openlocfilehash: 2eb44604e72b32292f971754d4f8c4fd1988c697
ms.sourcegitcommit: dab2cbf818fafc9436e685376df94c5e44e4b144
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/13/2021
ms.locfileid: "6555185"
---
# <a name="use-models-based-on-azure-machine-learning-studio-classic"></a>Используйте модели на основе студии машинного обучения Azure (классическая версия)

Единые данные в Dynamics 365 Customer Insights являются источником для построения моделей машинного обучения, которые могут дать дополнительную бизнес-аналитику. Customer Insights интегрируется со студией машинного обучения (классической) для использования ваших собственных настраиваемых моделей. Чтобы узнать, как модели, разработанные в машинном обучении Azure, интегрируются с Customer Insights, см. [Эксперименты с машинным обучением Azure](azure-machine-learning-experiments.md).

## <a name="prerequisites"></a>Предварительные условия

- Доступ к Customer Insights
- Активная подписка Azure Enterprise
- [Объединенные профили клиента](data-unification.md)
- Настройка [экспорта сущностей в хранилище BLOB-объектов Azure](export-azure-blob-storage.md)

## <a name="set-up-machine-learning-studio-classic"></a>Настройка студии машинного обучения (классическая версия)

На первом этапе нам нужно создать рабочую область и открыть студию машинного обучения (классическую).

1. Перейдите в [https://www.portal.azure.com](https://www.portal.azure.com/) и выполните вход.

1. Выберите **Создать ресурс**.

1. Найдите пункт **Рабочая область студии машинного обучения** и выберите **Создать**.

1. Введите необходимые данные для [создания рабочей области](/azure/machine-learning/studio/create-workspace). Выберите **Ценовая категория плана веб-службы** в зависимости от объема данных, которые вы планируете импортировать. Для лучшей производительности выберите **Расположение**, которое географически ближе всего к вам.

1. После создания ресурса появится панель мониторинга рабочей областью студии машинного обучения. Выберите **Запустить студию машинного обучения**.

   ![Пользовательский интерфейс студии машинного обучения Azure.](media/azure-machine-learning-studio.png)

## <a name="work-with-azure-machine-learning-studio"></a>Работа со студией машинного обучения Azure

Теперь вы можете создать новый эксперимент или импортировать существующий шаблон эксперимента из галереи образцов. Есть примеры экспериментов для трех стандартных сценариев:

- [Прогноз оттока](#churn-analysis)

- [Ценность клиента на протяжении жизненного цикла](#customer-lifetime-value-prediction)

- [Рекомендация продуктов или оптимальное следующее действие](#productrecommendation-or-next-best-action)

1. Если вы создаете новый эксперимент или используете шаблон эксперимента из галереи, вам необходимо настроить свойства **Импорт данных**. Воспользуйтесь интерфейс с подсказками или напрямую предоставьте подробные сведения для доступа к хранилищу BLOB-объектов Azure, содержащему ваши данные.  

   ![Эксперимент студии машинного обучения Azure.](media/azure-machine-learning-studio-experiment.png)

1. Теперь вы можете создать пользовательский конвейер обработки для очистки и предварительной обработки данных, извлечения компонентов и обучения подходящей модели.

1. Протестируйте и оптимизируйте производительность модели.

1. Если вас устраивает качество модели, выберите **Настроить веб-службу** > **Прогнозная веб-служба**. Эта опция импортирует обученную модель и конвейер характеристик из обучающего эксперимента в службу прогнозирования. Служба прогнозирования может принимать другой набор входных данных со схемой, используемой в обучающем эксперименте, для создания прогнозов.

   ![Настройка прогнозной веб-службы.](media/predictive-webservice-control.png)

1. После успешного эксперимента с прогнозирующей веб-службой вы можете развернуть ее для автоматического планирования. Чтобы веб-служба работала с Customer Insights, выберите **Развернуть веб-службу** > **Развернуть предварительную версию веб-службы [Новое]**. [Дополнительные сведения о развертывании веб-службы](/azure/machine-learning/studio/deploy-a-machine-learning-web-service).

   ![Развертывание прогнозной веб-службы.](media/predictive-webservice-deploy.png)

## <a name="sample-models-from-the-gallery"></a>Образцы моделей из галереи

Мы будем использовать вымышленный сценарий отеля Contoso для моделей из этой статьи. Отель Contoso собирает следующие данные:

- Данные CRM, состоящие из активности проживания в отеле. Набор данных включает информацию о сроках пребывания для каждого зарегистрированного клиента. Он также содержит информацию о бронировании, типах номеров, деталях расходов и т. д. Данные охватывают четыре года, с января 2014 года по январь 2018 года.
- Профили клиентов гостей отеля. Эти профили содержат информацию о каждом клиенте, включая его имя, дату рождения, почтовый адрес, пол и номер телефона.
- Использование служб, предлагаемых отелем, таких как спа, прачечная, Wi-Fi или курьерская служба. Эта информация регистрируется для каждого зарегистрированного клиента. Как правило, использование услуг связано с проживанием. В некоторых случаях клиенты могут пользоваться услугами, не останавливаясь в отеле.

## <a name="churn-analysis"></a>Анализ оттока

Анализ оттока применяется к разным сферам бизнеса. В этом примере мы рассмотрим отток в сфере услуг, в частности, в контексте гостиничных услуг, как описано выше. Он представляет собой рабочий пример конвейера сквозной модели, который можно использовать в качестве отправной точки для любого другого типа модели оттока.

### <a name="definition-of-churn"></a>Определение оттока

Определение оттока может отличаться в зависимости от сценария. В этом примере гость, который не посещал отель в прошлом году, должен быть помечен как отток.  

Шаблон эксперимента можно импортировать из галереи. Во-первых, убедитесь, что вы импортируете данные для **Действие проживания в отеле**, **Данные клиентов** и **Данные об использовании услуг** из хранилища BLOB-объектов Azure.

   ![Импорт данных для модели оттока.](media/import-data-azure-blob-storage.png)

### <a name="featurization"></a>Конструирование признаков

Основываясь на определении оттока, мы сначала определяем необработанные характеристики, которые будут влиять на ярлык. Затем мы преобразуем эти необработанные характеристики в числовые характеристики, которые можно использовать с моделями машинного обучения. Интеграция данных происходит в Customer Insights, поэтому мы можем объединить эти таблицы с помощью *идентификатора пользователя*.

   ![Объединение импортированных данных.](media/join-imported-data.png)

Конструирование признаков для построения модели для анализа оттока может быть немного сложной задачей. Данные являются функцией времени, при этом ежедневно регистрируются новые действия в отеле. Во время конструирования признаков мы хотим генерировать статические признаки из динамических данных. В этом случае мы генерируем несколько характеристик на основе действий отеля со скользящим окном в один год. Мы также расширяем категориальные характеристики, такие как тип номера или тип бронирования, на отдельные характеристики, используя однократное кодирование.  

Окончательный список признаков:

| **Номер**  | **Original_Column**          | **Производные признаки**                                                                                                                      |
|-------------|------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 1           | Тип номера                    | RoomTypeLargeCount, RoomTypeSmallCount                                                                                                    |
| 2           | Тип резервирования                 | BookingTypeOnlineCount, BookingTypePhoneCallCount                                                                                         |
| 3           | Категория путешествия              | TravelCategoryBusinessCount, TravelCategoryLeisureCount                                                                                   |
| 4           | Потрачено долларов                | TotalDollarSpent                                                                                                                          |
| 5           | Даты заезда и выезда  | StayDayCount, StayDayCount2016, StayDayCount2015, StayDayCount2014, StayCount, StayCount2016. StayCount2015, StayCount2014                |
| 6           | Использование услуг                | UsageTenure, ConciergeUsage, CourierUsage, DryCleaningUsage, GymUsage, PhoneUsage, RestaurantUsage, SpaUsage, TelevisionUsage, WifiUsage  |

### <a name="model-selection"></a>Выбор модели

Теперь нам нужно выбрать оптимальный алгоритм для использования. В этом случае большинство признаков основано на категориальных характеристиках. Обычно хорошо работают модели на основе дерева решений. Если есть только числовые признаки, нейронные сети могут быть лучшим выбором. Метод опорных векторов (SVM) также является хорошим кандидатом в таких ситуациях; однако для достижения максимальной производительности требуется немало настроек. Мы выбираем **Улучшенное двухклассовое дерево принятия решений** в качестве первой модели выбора, за которой следует **Двухклассовая SVM** как вторая модель. Студия машинного обучения Azure позволяет проводить A/B-тестирование, поэтому лучше начинать с двух моделей, а не с одной.

На следующем изображении показан конвейер обучения и оценки моделей из студии машинного обучения Azure:

![Модель оттока в студии машинного обучения Azure.](media/azure-machine-learning-model.png)

Мы также применяем технику под названием **Важность компонента перестановки** — важный аспект оптимизации модели. Встроенные модели практически не дают представления о влиянии какой-либо конкретной характеристики на окончательный прогноз. Калькулятор важности признаков использует специальный алгоритм для вычисления влияния отдельных признаков на результат для конкретной модели. Важность признака нормируется от +1 до –1. Отрицательное влияние означает, что соответствующий признак оказывает неожиданное влияние на результат и должна быть удалена из модели. Положительное влияние указывает на то, что этот признак вносит большой вклад в прогноз. Эти значения не являются коэффициентами корреляции, поскольку это разные показатели. Дополнительные сведения см. в разделе[Важность признаков перестановки](/azure/machine-learning/studio-module-reference/permutation-feature-importance).

Целиком [эксперимент с оттоком доступен в коллекции решений ИИ Azure](https://gallery.azure.ai/Experiment/Hotel-Churn-Predictive-Exp).

## <a name="customer-lifetime-value-prediction"></a>Прогноз ценности клиентов в течение всего срока работы с ними

Расчет ценности клиентов в течение всего срока работы с ними (CLTV) — один из ключевых показателей, который бизнес может использовать для оценки и сегментации своих клиентов. Для гостиничного бизнеса очень важно знать своих клиентов. Например, понимание факторов, составляющих хороших клиентов, является важной информацией. Это помогает руководству отеля оценить, на каких характеристиках им нужно сосредоточиться и улучшить их, чтобы удовлетворить своих клиентов, приносящих высокий доход. Эти решения могут иметь прямое влияние на продажи и прибыль.  

### <a name="definition-of-cltv"></a>Определение CLTV

В этом примере мы определяем CLTV клиента как общую сумму в долларах, которую клиент, как ожидается, потратит в следующие 365 дней. Мы собираемся использовать данные за последние три года для всех клиентов, чтобы прогнозировать это значение.

### <a name="featurization"></a>Конструирование признаков

В этом случае конструирование признаков будет очень похоже на сценарий оттока. Однако метки и прогнозируемые значения отличаются от указанных выше.

### <a name="model-selection"></a>Выбор модели

Прогнозирование CLTV представляет собой проблему регрессии, поскольку прогнозируемое значение является непрерывной переменной с положительным знаком. На основании свойств признаков мы выбираем модель **Усиленная регрессия дерева решений** как один алгоритм и **Регрессия нейронной сети** как еще один алгоритм для обучения модели.

## <a name="product-recommendation-or-next-best-action"></a>Рекомендация продуктов или оптимальное следующее действие

Рекомендация продуктов в гостиничном сценарии интерпретируется как рекомендация услуг, предлагаемых отелем клиентам. Цель состоит в том, чтобы выбрать подходящие услуги для клиентов, чтобы их использование было максимальным. Это похоже на рекомендации фильмов для пользователей сервиса потокового видео.

### <a name="definition-of-product-recommendation-or-next-best-action"></a>Определение рекомендации продуктов или оптимального следующего действия

Мы определяем цель как максимальное использование услуг в долларах за счет предложения наиболее подходящих услуг клиентам отеля в соответствии с их интересами.

### <a name="featurization"></a>Конструирование признаков

Как и в модели оттока, мы объединяем ServiceCustomerID отеля с CustomerID, чтобы последовательно вырабатывать рекомендации для каждого CustomerID.

![Конструирование признаков рекомендательной модели.](media/azure-machine-learning-model-featurization.png)

Данные берутся из трех разных сущностей, и на их основе извлекаются признаки. Конструирование признаков для проблемы рекомендации отличается от сценариев оттока клиентов или CLTV. Модель рекомендаций требует входных данных в виде трех наборов признаков.

### <a name="model-selection"></a>Выбор модели

Мы прогнозируем продукты или услуги, используя алгоритм, называемый **Обучение рекомендаций Matchbox**,чтобы обучить модель рекомендаций.

![Алгоритм рекомендаций по продуктам.](media/azure-machine-learning-model-recommendation-algorithm.png)

Три входных порта для модели **Обучение рекомендаций Matchbox** принимают обучающие данные об использовании услуг, описание клиентов (необязательно) и описание услуги. Есть три разных способа оценки модели. Один предназначен для оценки модели, где для ранжирования оцениваемых элементов рассчитывается оценка нормализованной дисконтированной совокупной прибыли (NDCG). В этом эксперименте наша оценка NDCG составляет 0,97. Два других варианта — это оценка модели по всему каталогу рекомендуемых услуг или оценка только по элементам, которые пользователи не использовали ранее.

Рассматривая дальше распределение рекомендаций по всему каталогу услуг, мы замечаем, что телефон, Wi-Fi и курьерская служба являются лучшими услугами, которые следует рекомендовать. Это согласуется с тем, что мы обнаружили из распределений данных о потреблении услуг:

![Выходные данные модели рекомендаций.](media/azure-machine-learning-model-output.png)

Целиком [эксперимент с рекомендациями по продукту доступен в коллекции решений ИИ Azure.](https://gallery.azure.ai/Experiment/Recommendation-4)

## <a name="integrate-custom-models"></a>Интегрируйте собственные модели

Чтобы использовать эти прогнозы в Customer Insights, вам необходимо **экспортировать** прогнозы вместе с идентификаторами клиентов. [Экспортируйте их в то же хранилище BLOB-объектов Azure](/azure/storage/common/storage-import-export-data-from-blobs), в которое вы экспортируете исходные данные. Прогностическую веб-службу можно запланировать для регулярного запуска и обновления оценок.

Данные, созданные с помощью настраиваемой модели, можно использовать для дальнейшего обогащения данных о ваших клиентах. Дополнительные сведения см. в разделе [Пользовательские модели машинного обучения](custom-models.md).


[!INCLUDE[footer-include](../includes/footer-banner.md)]