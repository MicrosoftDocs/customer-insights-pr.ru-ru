---
title: Подключение к источнику данных Power Query (содержит видео)
description: Прием данных через соединитель Power Query (содержит видео).
ms.date: 09/29/2022
ms.reviewer: v-wendysmith
ms.subservice: audience-insights
ms.topic: how-to
author: mukeshpo
ms.author: mukeshpo
manager: shellyha
searchScope:
- ci-data-sources
- ci-create-data-source
- customerInsights
ms.openlocfilehash: 4cc7e57dfb0f8d050e91adc441c24e849882f5d8
ms.sourcegitcommit: be341cb69329e507f527409ac4636c18742777d2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2022
ms.locfileid: "9609912"
---
# <a name="connect-to-a-power-query-data-source"></a>Подключение к источникам данных Power Query

Power Query содержит широкий набор соединителей для приема данных. Большинство этих соединителей поддерживаются Dynamics 365 Customer Insights.

Добавление источников данных на базе соединителей Power Query обычно выполняется в соответствии с шагами, описанными в этом разделе. Однако в зависимости от используемого соединителя требуется различная информация. Подробнее см. в документации по отдельным соединителям в [справочнике по соединителям Power Query](/power-query/connectors/).

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RWN6EK]

## <a name="create-a-new-data-source"></a>Создание нового источника данных

1. Перейдите в раздел **Данные** > **Источники данных**.

1. Выберите **Добавить источник данных**.

1. Выберите **Microsoft Power Query**.

1. Укажите **Имя** и необязательное **Описание** для источника данных и выберите **Далее**.

1. Выберите один из [доступных соединителей](#available-power-query-data-sources). В этом примере мы выберем соединитель **Текст/CSV**.

1. Введите необходимые данные в поле **Параметры соединения** для выбранного соединителя и выберите **Далее** для предварительного просмотра данных.

1. Выберите **Преобразовать данные**.

1. Проверьте и уточните данные на странице **Power Query — Изменение запросов**. Сущности, идентифицированные системами в выбранном источнике данных, отображаются на левой панели.

   :::image type="content" source="media/data-manager-configure-edit-queries.png" alt-text="Диалог изменения запросов":::

1. Преобразуйте свои данные. Выберите сущность для изменения или преобразования. Используйте параметры в окне Power Query для применения преобразований. Каждое преобразование указано в пункте **Примененные шаги**. Power Query содержит множество [готовых вариантов преобразования](/power-query/power-query-what-is-power-query#transformations).

   > [!IMPORTANT]
   > Рекомендуем использовать следующие преобразования:
   >
   > - Если вы принимаете данные из файла CSV, первая строка часто содержит заголовки. Перейдите в **Преобразовать** и выберите **Использовать первую строку в качестве заголовков**.
   > - Убедитесь, что тип данных установлен правильно и соответствует данным. Например, для полей даты выберите тип даты.

1. Чтобы добавить дополнительные объекты в ваш источник данных в диалоговом окне **Изменение запросов**, перейдите в **Главная** и выберите **Получить данные**. Повторяйте шаги 5–10, пока не добавите все сущности для этого источника данных. Если у вас есть база данных, которая включает в себя несколько наборов данных, каждый набор данных является своей собственной сущностью.

1. Выберите **Сохранить**. Открывается страница **Источники данных** с новым источником данных в статусе **Обновление**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

Загрузка данных может занять время. После успешного обновления принятые данные можно проверить на странице [**Сущности**](entities.md).

> [!CAUTION]
>
> - Источник данных на основе Power Query [создает поток данных в Dataverse](/power-query/dataflows/overview-dataflows-across-power-platform-dynamics-365). Не меняйте имя потока данных в Центр администрирования Power Platform, который используется в Customer Insights. Переименование потока данных вызывает проблемы со ссылками между источником данных Customer Insights и потоком данных Dataverse.
> - Параллельные оценки для источников данных Power Query в Customer Insights имеют одинаковые [ограничения обновления, такие как потоки данных в PowerBI.com](/power-query/power-query-online-limits#refresh-limits). Если обновление данных завершается со сбоем из-за достижения предела оценки, мы рекомендуем настроить расписание обновления для каждого потока данных, чтобы источники данных не обрабатывались одновременно.

### <a name="available-power-query-data-sources"></a>Доступные источники данных Power Query

Список соединителей, которые можно использовать для импорта данных в Customer Insights, см. в [справочнике по соединителям Power Query](/power-query/connectors/).

Соединители с флажком в столбце **Customer Insights (потоки данных)** доступны для создания новых источников данных на основе Power Query. Просмотрите документацию по конкретному соединителю, чтобы узнать больше о его предварительных требованиях, [ограничениях запросов](/power-query/power-query-online-limits) и другие детали.

## <a name="add-data-from-on-premises-data-sources"></a>Добавление данных из локальных источников данных

Прием данных из локальных источников данных поддерживается на основе потоков данных Microsoft Power Platform (PPDF). Вы можете включить потоки данных в Customer Insights путем [указания URL-адреса среды Microsoft Dataverse](create-environment.md) при настройке среды.

Для источников данных, созданных после связывания среды Dataverse с Customer Insights, [потоки данных Power Platform](/power-query/dataflows/overview-dataflows-across-power-platform-dynamics-365) используются по умолчанию. Потоки данных поддерживают локальное подключение с использованием шлюза данных. Вы можете удалить и заново создать источники данных, которые существовали до того, как среда Dataverse была связана с Customer Insights, [с помощью локальных шлюзов данных](/data-integration/gateway/service-gateway-app).

Шлюзы данных из существующих сред Power BI или Power Apps будут видны, и вы сможете повторно использовать их в Customer Insights, если шлюз данных и среда Customer Insights находятся в одном и том же регионе Azure. На странице источников данных показаны ссылки для перехода к среде Microsoft Power Platform, в которой можно просматривать и настраивать локальные шлюзы данных.

> [!IMPORTANT]
> Убедитесь, что ваши шлюзы обновлены до последней версии. Вы можете установить обновление и перенастроить шлюз непосредственно из подсказки, отображаемой на экране шлюза, или [скачать последнюю версию](https://powerapps.microsoft.com/downloads/). Если вы не используете последнюю версию шлюза, обновление потока данных завершается с ошибкой, например **Ключевое слово не поддерживается: свойства конфигурации. Имя параметра: ключевое слово**.
>
> Ошибки с локальными шлюзами данных в Customer Insights часто возникают из-за проблем с конфигурацией. Для получения дополнительной информации об устранении неполадок со шлюзами данных см. статью [Устранение неполадок локального шлюза данных](/data-integration/gateway/service-gateway-tshoot).

## <a name="edit-power-query-data-sources"></a>Редактировать источники данных Power Query

> [!NOTE]
> Возможно, не удастся внести изменения в источники данных, которые в настоящее время используются в одном из процессов приложения (например, сегментация или унификация данных).
>
> На странице **Настройки** можно отслеживать ход выполнения каждого из активных процессов. Когда процесс завершается, вы можете вернуться на страницу **Источники данных** и внести изменения.

1. Перейдите в раздел **Данные** > **Источники данных**.

1. Рядом с источником данных, который необходимо обновить, выберите **Изменить**.

1. Примените свои изменения и преобразования диалоговом окне **Power Query — Изменение запросов**, как описано в разделе [Создайте новый источник данных](#create-a-new-data-source).

1. Выберите **Сохранить**, чтобы применить изменения и вернуться на страницу **Источники данных**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

## <a name="common-reasons-for-ingestion-errors-or-corrupt-data"></a>Распространенные причины ошибок приема или повреждения данных

### <a name="data-type-does-not-match-data"></a>Тип данных не соответствует данным

Наиболее распространенное несоответствие типов данных возникает, когда для поля даты задан неправильный формат даты.

Данные могут быть исправлены в источнике и повторно приняты. Или исправьте преобразование в Customer Insights. Чтобы исправить преобразование:

1. Перейдите в раздел **Данные** > **Источники данных**.

1. Рядом с источником данных с поврежденными данными выберите **Изменить**.

1. Выберите **Далее**.

1. Выберите каждый из запросов и найдите неверные преобразования, примененные в «Примененных шагах», или столбцы дат, которые не были преобразованы с форматом даты.

   :::image type="content" source="media/PQ_corruped_date.png" alt-text="Power Query — изменение, показывающее неправильный формат даты":::

1. Измените тип данных, чтобы он правильно соответствовал данным.

1. Выберите **Сохранить**. Какой источник данных обновляется.

## <a name="troubleshoot-ppdf-power-query-based-data-source-refresh-issues"></a>Устранение проблем обновления источника данных на основе PPDF Power Query

Если данные устарели или вы получаете сообщения об ошибках после обновления источник данных, выполните следующие действия:

1. Перейдите по адресу [Power Platform](https://make.powerapps.com).

1. Выберите **Среду** для вашего экземпляра Customer Insights.

1. Перейдите в **Потоки данных**.

1. Для потока данных, соответствующего источника данных в Customer Insights, выберите вертикальный многоточие (&vellip;), затем выберите **Показать историю обновлений**.

1. Если **Статус** потока данных **Успех**, право собственности на источник данных на основе Power Query могло быть изменено:

   1. Просмотрите расписание обновления из истории обновлений.
   1. Установите расписание нового владельца и сохраните параметры.

1. Если **Статус** потока данных **Отклонено**:

   1. Загрузите файл истории обновлений.
   1. Просмотрите загруженный файл, чтобы выяснить причину сбоя.
   1. Если ошибка не может быть устранена, выберите **?** для открытия запроса в службу поддержки. Включите загруженный файл истории обновлений.


[!INCLUDE [footer-include](includes/footer-banner.md)]
