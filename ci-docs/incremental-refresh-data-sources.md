---
title: Инкрементное обновление для источников данных Power Query и Azure Data Lake
description: Обновляйте новые и обновленные данные для больших источников данных на основе источников данных Power Query или Azure Data Lake.
ms.date: 05/30/2022
ms.reviewer: v-wendysmith
ms.subservice: audience-insights
ms.topic: how-to
author: mukeshpo
ms.author: mukeshpo
manager: shellyha
searchScope:
- ci-system-schedule
- customerInsights
ms.openlocfilehash: de39743eb8728fac34e417724c5f73bf44309c89
ms.sourcegitcommit: 5807b7d8c822925b727b099713a74ce2cb7897ba
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2022
ms.locfileid: "9207153"
---
# <a name="incremental-refresh-for-power-query-and-azure-data-lake-data-sources"></a>Инкрементное обновление для источников данных Power Query и Azure Data Lake

Инкрементное обновление источников данных на основе Power Query или Azure Data Lake обеспечивает следующие преимущества:

- **Быстрее обновляется** — только данные, которые изменились, обновляются. Например, вы можете обновить только последние пять дней исторического набора данных.
- **Повышенная надежность** — при меньших обновлениях вам не нужно поддерживать соединения с ненадежными исходными системами слишком долго, что снижает риск проблем с подключением.
- **Снижение потребления ресурсов** — обновление только подмножества ваших общих данных приводит к более эффективному использованию вычислительных ресурсов и уменьшает воздействие на окружающую среду.

## <a name="configure-incremental-refresh-for-data-sources-based-on-power-query"></a>Настройка инкрементного обновления для источников данных на основе Power Query

Customer Insights позволяет инкрементное обновление для источников данных, импортированные через Power Query, которые поддерживают добавочный прием. Например, базы данных SQL Azure с полями даты и времени, которые указывают время последнего обновления записей данных.

1. [Создайте новый источник данных на основе Power Query](connect-power-query.md).

1. Выберите источник данных, который поддерживает инкрементное обновление, например [базу данных SQL Azure](/power-query/connectors/azuresqldatabase).

1. Выберите сущности или таблицы для приема.

1. Выполните шаги преобразования и выберите **Далее**.

1. В диалоговом окне **Настройка инкрементного обновления** выберите **Настроить**, чтобы открыть **Настройки инкрементного обновления**. Если вы выберете **Пропустить**, источник данных обновит весь набор данных.
   > [!TIP]
   > Вы также можете применить инкрементное обновление позже, отредактировав существующий источник данных.

1. В разделе **Настройки инкрементного обновления** вы настроите инкрементное обновление для всех сущностей, выбранных вами при создании источника данных.

   :::image type="content" source="media/incremental-refresh-settings.png" alt-text="Настройка параметров инкрементного обновления.":::

1. Выберите сущность и предоставьте следующую информацию:

   - **Определить первичный ключ**: выберите первичный ключ для сущности или таблицы.
   - **Определите поле "последнее обновление"**: в этом поле отображаются только атрибуты типа дата или время. Выберите атрибут, который указывает, когда записи были в последний раз обновлены. Он будет использоваться для идентификации записей, попадающих в интервал времени инкрементного обновления.
   - **Проверять обновления каждые**: укажите, какой длины должен быть интервал времени инкрементного обновления.

1. Выберите **Сохранить**, чтобы завершить создание источника данных. Первоначальное обновление данных будет полным обновлением. После этого инкрементное обновление данных происходит в соответствии с настройками предыдущего шага.

## <a name="configure-incremental-refresh-for-azure-data-lake-data-sources"></a>Настройка инкрементного обновления для источников данных Azure Data Lake

Customer Insights позволяет выполнять инкрементное обновление для источников данных, подключенных к Azure Data Lake Storage. Чтобы использовать инкрементный прием и обновление для сущности, настройте эту сущность при добавлении источника данных Azure Data Lake или позже при редактировании источника данных. Папка данных сущности должна содержать следующие папки:

- **FullData**: папка, в которой находятся файлы данных, содержащие первоначальные записи
- **IncrementalData**: папка с иерархическими папками даты/времени в формате **гггг/мм/дд/чч**, содержащими инкрементные обновления. **чч** представляет час UTC обновлений и содержит папки **Upserts** и **Deletes**. **Upserts** содержит файлы данных с обновлениями существующих записей или новые записи. **Deletes** содержит файлы данных с записями, подлежащими удалению.

1. При добавлении или редактировании источника данных перейдите на панель **Атрибуты** для сущности.

1. Просмотрите атрибуты. Убедитесь, что атрибут даты создания или последнего обновления настроен с **форматом даты** *Дата и время* и **семантическим типом** *Календарь.Дата*. При необходимости отредактируйте атрибут и выберите **Готово**.

1. На панели **Выберите сущности** отредактируйте сущность. Установлен флажок **Добавочный прием**.

   :::image type="content" source="media/ADLS_inc_refresh.png" alt-text="Настройка сущностей в источнике данных для инкрементного обновления.":::

   1. Перейдите в корневую папку, содержащую файлы .csv или .parquet для полных данных, инкрементных обновлений и добавлений данных и инкрементных удалений данных.
   1. Введите расширение для полных данных и обоих инкрементных файлов (\.csv или \.parquet).
   1. Для файлов .csv выберите разделитель столбцов и, если вы хотите, чтобы первая строка файла использовалась в качестве заголовка столбца.
   1. Выберите **Сохранить**.

1. Для поля **Последнее обновление** выберите атрибут метки даты и времени.

1. Если **Первичный ключ** не выбран, выберите первичный ключ. Первичный ключ — это атрибут, уникальный для сущности. Чтобы атрибут был действительным первичным ключом, он не должен включать повторяющиеся значения, отсутствующие значения или значения NULL. В качестве первичных ключей поддерживаются атрибуты типа данных: строка, целое число, GUID.

1. Выберите **Закрыть**, чтобы сохранить и закрыть панель.

1. Переходите к добавлению или редактированию источника данных.

[!INCLUDE [footer-include](includes/footer-banner.md)]
